<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Billions Supermasks</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0;
      padding: 0;
    }

    .top-bar {
      margin: 10px;
    }

    .frame {
      position: relative;
      width: 400px;
      height: 400px;
      border: 2px dashed #aaa;
      background: #f9f9f9;
      overflow: hidden;
    }

    .frame img.uploaded {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .mask-layer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    .mask {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 100px;
      height: 100px;
      transform: translate(-50%, -50%);
      cursor: move;
      pointer-events: auto;
    }

    .mask img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      user-select: none;
      pointer-events: none;
    }

    /* Resizer handles */
    .resizer {
      width: 10px;
      height: 10px;
      background: #000;
      position: absolute;
      right: -5px;
      bottom: -5px;
      cursor: se-resize;
    }

    .rotator {
      width: 10px;
      height: 10px;
      background: red;
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      cursor: grab;
    }

    /* Mask panel */
    .panel {
      position: fixed;
      top: 0;
      right: -220px;
      width: 200px;
      height: 100%;
      background: #f1f1f1;
      border-left: 2px solid #ccc;
      overflow-y: auto;
      transition: right 0.3s ease;
      padding: 10px;
    }

    .panel.open {
      right: 0;
    }

    .panel img {
      width: 80px;
      margin: 5px;
      cursor: pointer;
    }

    button {
      margin: 5px;
      padding: 6px 12px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <input type="file" id="upload" accept="image/*">
    <button id="togglePanel">Supermasks</button>
    <button id="resetAll">Reset All</button>
  </div>

  <div class="frame">
    <img id="uploadedImage" class="uploaded" src="" alt="">
    <div class="mask-layer" id="maskLayer"></div>
  </div>

  <div class="panel" id="maskPanel">
    <button id="resetMasks">Reset Masks</button>
    <div id="maskList"></div>
  </div>

  <script>
    const upload = document.getElementById('upload');
    const uploadedImage = document.getElementById('uploadedImage');
    const maskLayer = document.getElementById('maskLayer');
    const maskPanel = document.getElementById('maskPanel');
    const togglePanel = document.getElementById('togglePanel');
    const resetAll = document.getElementById('resetAll');
    const resetMasks = document.getElementById('resetMasks');
    const maskList = document.getElementById('maskList');

    // Generate mask thumbnails (1â€“36)
    for (let i = 1; i <= 36; i++) {
      const img = document.createElement('img');
      img.src = `masks/${i}.png`;
      img.dataset.mask = `masks/${i}.png`;
      img.onclick = () => addMask(img.dataset.mask);
      maskList.appendChild(img);
    }

    // Upload image
    upload.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (event) => {
          uploadedImage.src = event.target.result;
        };
        reader.readAsDataURL(file);
      }
    });

    // Toggle panel
    togglePanel.addEventListener('click', () => {
      maskPanel.classList.toggle('open');
    });

    // Reset everything
    resetAll.addEventListener('click', () => {
      uploadedImage.src = '';
      maskLayer.innerHTML = '';
    });

    // Reset only masks
    resetMasks.addEventListener('click', () => {
      maskLayer.innerHTML = '';
    });

    // Add mask
    function addMask(src) {
      const wrapper = document.createElement('div');
      wrapper.classList.add('mask');
      wrapper.style.top = "50%";
      wrapper.style.left = "50%";
      wrapper.style.transform = "translate(-50%, -50%)";

      const mask = document.createElement('img');
      mask.src = src;

      // Resizer
      const resizer = document.createElement('div');
      resizer.classList.add('resizer');

      // Rotator
      const rotator = document.createElement('div');
      rotator.classList.add('rotator');

      wrapper.appendChild(mask);
      wrapper.appendChild(resizer);
      wrapper.appendChild(rotator);
      maskLayer.appendChild(wrapper);

      makeInteractive(wrapper, resizer, rotator);
    }

    function makeInteractive(element, resizer, rotator) {
      let isDragging = false, isResizing = false, isRotating = false;
      let startX, startY, startWidth, startHeight, startAngle = 0, rotation = 0;

      // Move
      element.addEventListener('mousedown', (e) => {
        if (e.target === resizer || e.target === rotator) return;
        isDragging = true;
        startX = e.clientX - element.offsetLeft;
        startY = e.clientY - element.offsetTop;
      });

      document.addEventListener('mousemove', (e) => {
        if (isDragging) {
          element.style.left = e.clientX - startX + "px";
          element.style.top = e.clientY - startY + "px";
        }
        if (isResizing) {
          element.style.width = startWidth + (e.clientX - startX) + "px";
          element.style.height = startHeight + (e.clientY - startY) + "px";
        }
        if (isRotating) {
          const rect = element.getBoundingClientRect();
          const cx = rect.left + rect.width / 2;
          const cy = rect.top + rect.height / 2;
          const dx = e.clientX - cx;
          const dy = e.clientY - cy;
          rotation = Math.atan2(dy, dx) * (180 / Math.PI);
          element.style.transform = `translate(-50%, -50%) rotate(${rotation}deg)`;
        }
      });

      document.addEventListener('mouseup', () => {
        isDragging = false;
        isResizing = false;
        isRotating = false;
      });

      // Resize
      resizer.addEventListener('mousedown', (e) => {
        e.stopPropagation();
        isResizing = true;
        startX = e.clientX;
        startY = e.clientY;
        startWidth = parseInt(document.defaultView.getComputedStyle(element).width, 10);
        startHeight = parseInt(document.defaultView.getComputedStyle(element).height, 10);
      });

      // Rotate
      rotator.addEventListener('mousedown', (e) => {
        e.stopPropagation();
        isRotating = true;
      });
    }
  </script>
</body>
</html>
