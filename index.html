<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Billions Supermasks</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --blue: #1e90ff;
      --dark: #111;
      --radius: 16px;
    }
    body {
      margin: 0;
      min-height: 100vh;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(90deg, #ff69b4 50%, #4ef5a2 50%);
      color: var(--dark);
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .container { text-align: center; max-width: 720px; width: 94%; padding: 20px; }
    h1 { margin: 0 0 16px; line-height: 1.2; }
    .title-top { display: block; font-weight: 400; font-size: 1.4rem; }
    .title-main { display: block; font-weight: 700; font-size: 2.6rem; }
    .buttons { display: flex; justify-content: center; gap: 10px; margin-bottom: 14px; flex-wrap: wrap; }
    button {
      padding: 8px 14px; font-size: 0.9rem; font-weight: 600; border: none; border-radius: var(--radius);
      cursor: pointer; transition: all 0.2s ease; background: linear-gradient(180deg, #1e90ff, #4682b4); color: #fff;
    }
    button:hover { filter: brightness(1.08); }
    .frame {
      width: min(460px, 92vw); aspect-ratio: 1/1; margin: 0 auto 20px;
      border-radius: var(--radius); overflow: hidden; position: relative;
      background: rgba(255,255,255,0.65); border: 3px solid rgba(255,255,255,0.6);
      display: flex; align-items: center; justify-content: center;
    }
    #preview, .mask-layer {
      position: absolute; top: 0; left: 0; cursor: grab; user-select: none;
    }
    .placeholder {
      width: 100%; height: 100%; border: 2px dashed rgba(0,0,0,0.1); border-radius: var(--radius);
    }
    .made-by { margin-top: 10px; font-size: 0.9rem; }
    .made-by a { color: #1e90ff; text-decoration: none; margin: 0 6px; }
    .made-by a:hover { text-decoration: underline; }

    #right-panel {
      position: fixed; top: 50%; right: 50px; transform: translateY(-50%);
      width: 300px; height: 550px; background: rgba(255,255,255,0.9);
      border-radius: 16px; box-shadow: 0 0 15px rgba(0,0,0,0.2);
      padding: 10px; display: none; z-index: 20; flex-direction: column;
    }
    #right-panel h3 { margin: 0; text-align: center; font-weight: 600; }
    #close-panel { position: absolute; top: 8px; right: 8px; background: none; border: none; font-size: 1.2rem; cursor: pointer; }
    #mask-list {
      flex: 1; display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;
      margin-top: 40px; overflow-y: scroll; scrollbar-width: thin;
      scrollbar-color: #1e90ff rgba(0,0,0,0.1); padding-bottom: 10px;
    }
    #mask-list::-webkit-scrollbar { width: 8px; }
    #mask-list::-webkit-scrollbar-thumb { background-color: #1e90ff; border-radius: 4px; }
    #mask-list::-webkit-scrollbar-track { background: rgba(0,0,0,0.05); border-radius: 4px; }
    #mask-list img { width: 100%; cursor: pointer; border-radius: 8px; object-fit: contain; }
    #mask-list img:hover { border-color: var(--blue); }
    #panel-reset {
      margin-top: 10px; padding: 6px 12px; border-radius: var(--radius); border: none;
      background: linear-gradient(180deg, #ff6347, #ff4500); color: #fff; font-weight: 600; cursor: pointer;
    }

    /* ðŸ”µ Resizer styles */
    #resizer {
      position: absolute;
      border: 2px solid #1e90ff;
      display: none;
      z-index: 15;
      pointer-events: none;
    }
    .handle {
      width: 10px; height: 10px; background: #1e90ff;
      position: absolute; border-radius: 2px; pointer-events: all;
    }
    .handle.tl { top: -5px; left: -5px; cursor: nwse-resize; }
    .handle.tr { top: -5px; right: -5px; cursor: nesw-resize; }
    .handle.bl { bottom: -5px; left: -5px; cursor: nesw-resize; }
    .handle.br { bottom: -5px; right: -5px; cursor: nwse-resize; }
    .handle.tm { top: -5px; left: 50%; transform: translateX(-50%); cursor: ns-resize; }
    .handle.bm { bottom: -5px; left: 50%; transform: translateX(-50%); cursor: ns-resize; }
    .handle.ml { left: -5px; top: 50%; transform: translateY(-50%); cursor: ew-resize; }
    .handle.mr { right: -5px; top: 50%; transform: translateY(-50%); cursor: ew-resize; }
  </style>
</head>
<body>
<div class="container">
  <h1>
    <span class="title-top">Billions</span>
    <span class="title-main">Supermasks</span>
  </h1>
  <div class="buttons">
    <input type="file" id="fileInput" accept="image/*" hidden>
    <button id="btnUpload">Upload</button>
    <button id="btnMask">Supermasks</button>
    <button id="btnDownload">Download</button>
    <button id="btnReset">Reset</button>
  </div>
  <div class="frame" id="frame">
    <div class="placeholder" id="placeholder"></div>
    <img id="preview" alt="">
    <!-- ðŸ”µ Universal Resizer Box -->
    <div id="resizer">
      <div class="handle tl"></div>
      <div class="handle tr"></div>
      <div class="handle bl"></div>
      <div class="handle br"></div>
      <div class="handle tm"></div>
      <div class="handle bm"></div>
      <div class="handle ml"></div>
      <div class="handle mr"></div>
    </div>
  </div>
  <div class="made-by">
    Made by:
    <a href="https://x.com/songoku230_" target="_blank">@songoku230_</a>
    <a href="https://x.com/TheFarLax" target="_blank">@TheFarLax</a>
  </div>
</div>

<div id="right-panel">
  <button id="close-panel">âœ•</button>
  <h3>Choose a Mask</h3>
  <div id="mask-list"></div>
  <button id="panel-reset">Reset Panel</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
const fileInput = document.getElementById('fileInput');
const preview = document.getElementById('preview');
const placeholder = document.getElementById('placeholder');
const frame = document.getElementById('frame');
const btnUpload = document.getElementById('btnUpload');
const btnMask = document.getElementById('btnMask');
const btnDownload = document.getElementById('btnDownload');
const btnReset = document.getElementById('btnReset');
const rightPanel = document.getElementById('right-panel');
const closePanel = document.getElementById('close-panel');
const maskList = document.getElementById('mask-list');
const panelReset = document.getElementById('panel-reset');
const resizerBox = document.getElementById("resizer");
let selectedMask = null;

// Upload user image
btnUpload.addEventListener('click', ()=>fileInput.click());
fileInput.addEventListener('change', e => { if(e.target.files[0]) loadImage(e.target.files[0]); });
function loadImage(file){
  const url = URL.createObjectURL(file);
  preview.src = url;
  preview.style.display = 'block';
  placeholder.style.display = 'none';
  preview.style.width = '100%';
  preview.style.height = '100%';
  preview.style.top = '0';
  preview.style.left = '0';
}

// Panel
btnMask.addEventListener('click', ()=>rightPanel.style.display='flex');
closePanel.addEventListener('click', ()=>rightPanel.style.display='none');

// Reset
btnReset.addEventListener('click', ()=>{
  preview.removeAttribute('src'); preview.style.display='none';
  placeholder.style.display='block'; fileInput.value='';
  document.querySelectorAll('.mask-layer').forEach(m=>m.remove());
  resizerBox.style.display = "none";
});

// Download
btnDownload.addEventListener('click', ()=>{
  html2canvas(frame).then(canvas=>{
    const link=document.createElement('a');
    link.href=canvas.toDataURL('image/png');
    link.download='supermask.png';
    link.click();
  });
});

// Masks
const masks=[];
for(let i=1;i<=36;i++) masks.push(`masks/mask${i}.png`);
masks.forEach(src=>{
  const img=document.createElement('img');
  img.src=src;
  img.addEventListener('click',()=>addMask(src));
  maskList.appendChild(img);
});

// Add mask
function addMask(src){
  const mask=document.createElement('img');
  mask.src=src;
  mask.classList.add('mask-layer');
  mask.style.width='100px';
  mask.style.top='20px';
  mask.style.left='20px';
  frame.appendChild(mask);

  // click select
  mask.addEventListener("click", e => {
    e.stopPropagation();
    selectMask(mask);
  });
}

// Mask select
function selectMask(mask) {
  selectedMask = mask;
  const rect = mask.getBoundingClientRect();
  const frameRect = frame.getBoundingClientRect();

  resizerBox.style.display = "block";
  resizerBox.style.width = rect.width + "px";
  resizerBox.style.height = rect.height + "px";
  resizerBox.style.left = (rect.left - frameRect.left) + "px";
  resizerBox.style.top = (rect.top - frameRect.top) + "px";
}

// Deselect on empty click
frame.addEventListener("click", e => {
  if (!e.target.classList.contains("mask-layer")) {
    selectedMask = null;
    resizerBox.style.display = "none";
  }
});

// Handle drag-resize
document.querySelectorAll("#resizer .handle").forEach(handle => {
  handle.addEventListener("mousedown", e => {
    e.preventDefault();
    if (!selectedMask) return;
    const startX = e.clientX;
    const startY = e.clientY;
    const startWidth = selectedMask.offsetWidth;
    const startHeight = selectedMask.offsetHeight;

    function onMouseMove(ev) {
      let newWidth = startWidth;
      let newHeight = startHeight;

      if (handle.classList.contains("mr")) newWidth += ev.clientX - startX;
      if (handle.classList.contains("ml")) newWidth -= ev.clientX - startX;
      if (handle.classList.contains("bm")) newHeight += ev.clientY - startY;
      if (handle.classList.contains("tm")) newHeight -= ev.clientY - startY;
      if (handle.classList.contains("br")) { newWidth += ev.clientX - startX; newHeight += ev.clientY - startY; }
      if (handle.classList.contains("bl")) { newWidth -= ev.clientX - startX; newHeight += ev.clientY - startY; }
      if (handle.classList.contains("tr")) { newWidth += ev.clientX - startX; newHeight -= ev.clientY - startY; }
      if (handle.classList.contains("tl")) { newWidth -= ev.clientX - startX; newHeight -= ev.clientY - startY; }

      if (newWidth > 20) selectedMask.style.width = newWidth + "px";
      if (newHeight > 20) selectedMask.style.height = newHeight + "px";

      selectMask(selectedMask); // update resizer position
    }

    function onMouseUp() {
      document.removeEventListener("mousemove", onMouseMove);
      document.removeEventListener("mouseup", onMouseUp);
    }

    document.addEventListener("mousemove", onMouseMove);
    document.addEventListener("mouseup", onMouseUp);
  });
});

// Panel reset
panelReset.addEventListener('click', ()=>{
  document.querySelectorAll('.mask-layer').forEach(m=>m.remove());
  resizerBox.style.display = "none";
});
</script>
</body>
</html>
