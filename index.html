<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Billions Supermasks</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --blue: #1e90ff;
      --dark: #111;
      --radius: 16px;
    }
    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(90deg, #ff69b4 50%, #4ef5a2 50%);
      color: var(--dark);
      overflow-y: auto;
    }
    .container {
      text-align: center;
      max-width: 720px;
      width: 94%;
      padding: 20px;
    }
    h1 { margin:0 0 16px; line-height:1.2; }
    .title-top { display:block; font-weight:400; font-size:1.4rem; }
    .title-main { display:block; font-weight:700; font-size:2.6rem; }
    .buttons {
      display:flex;
      justify-content:center;
      gap:10px;
      margin-bottom:14px;
      flex-wrap:wrap;
    }
    button, .upload, .supermasks, .download, .reset {
      padding: 8px 14px;
      font-size:0.9rem;
      font-weight:600;
      border:none;
      border-radius:var(--radius);
      cursor:pointer;
      transition: all 0.2s ease;
      background: linear-gradient(180deg,#1e90ff,#4682b4) !important;
      color:#fff !important;
    }
    button:hover { filter: brightness(1.08); box-shadow:0 0 8px rgba(30,144,255,0.5); }
    .frame {
      width:min(460px,92vw);
      aspect-ratio:1/1;
      margin:0 auto 20px;
      border-radius:var(--radius);
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(255,255,255,0.65);
      backdrop-filter: blur(10px);
      border:3px solid rgba(255,255,255,0.6);
      position:relative;
    }
    .frame.dragover { border:3px dashed var(--dark); background: rgba(255,255,255,0.8); }
    #preview { max-width:100%; max-height:100%; object-fit:contain; display:none; position:absolute; top:0; left:0; width:100%; height:100%; }
    .placeholder { width:100%; height:100%; border:2px dashed rgba(0,0,0,0.1); border-radius:var(--radius); }
    .made-by { margin-top:10px; font-size:0.9rem; }
    .made-by a { color:#1e90ff; text-decoration:none; margin:0 6px; }
    .made-by a:hover { text-decoration:underline; }

    /* Right Panel */
    #right-panel {
      position:fixed; top:50%; right:50px; transform:translateY(-50%);
      width:300px; height:550px; background: rgba(255,255,255,0.9);
      border-radius:16px; box-shadow:0 0 15px rgba(0,0,0,0.2);
      padding:10px; display:none; z-index:20; flex-direction:column;
    }
    #right-panel h3 { margin:0; text-align:center; font-weight:600; }
    #close-panel { position:absolute; top:8px; right:8px; background:none; border:none; font-size:1.2rem; cursor:pointer; }
    #mask-list { flex:1; display:grid; grid-template-columns:repeat(2,1fr); gap:10px; margin-top:40px; overflow-y:auto; padding-bottom:10px; }
    #mask-list img { width:100%; cursor:pointer; border:2px solid transparent; border-radius:8px; object-fit:contain; }
    #mask-list img:hover { border-color: var(--blue); }
    #panel-reset { margin-top:10px; padding:6px 12px; border-radius:var(--radius); border:none; background:linear-gradient(180deg,#ff6347,#ff4500); color:#fff; font-weight:600; cursor:pointer; }
    #panel-reset:hover { filter:brightness(1.1); }

    /* Mask container & handles */
    .mask-container { position:absolute; top:0; left:0; transform-origin:center center; cursor:grab; }
    .mask-container img { display:block; pointer-events:none; user-select:none; }
    .handle { width:12px; height:12px; background:#1e90ff; position:absolute; border-radius:2px; cursor:pointer; }
    .handle.br { bottom:0; right:0; cursor:se-resize; }
    .handle.tr { top:-20px; left:50%; transform:translateX(-50%); cursor:grab; border-radius:50%; background:#ff6347; }
  </style>
</head>
<body>
  <div class="container">
    <h1>
      <span class="title-top">Billions</span>
      <span class="title-main">Supermasks</span>
    </h1>
    <div class="buttons">
      <input type="file" id="fileInput" accept="image/*" hidden>
      <button class="upload" id="btnUpload">Upload</button>
      <button class="supermasks" id="btnMask">Supermasks</button>
      <button class="download" id="btnDownload">Download</button>
      <button class="reset" id="btnReset">Reset</button>
    </div>
    <div class="frame" id="frame">
      <div class="placeholder" id="placeholder"></div>
      <img id="preview" alt="">
    </div>
    <div class="made-by">
      Made by:
      <a href="https://x.com/songoku230_" target="_blank">@songoku230_</a>
      <a href="https://x.com/TheFarLax" target="_blank">@TheFarLax</a>
    </div>
  </div>

  <div id="right-panel">
    <button id="close-panel">âœ•</button>
    <h3>Choose a Mask</h3>
    <div id="mask-list"></div>
    <button id="panel-reset">Reset Panel</button>
  </div>

  <script>
    const fileInput = document.getElementById('fileInput');
    const preview = document.getElementById('preview');
    const placeholder = document.getElementById('placeholder');
    const frame = document.getElementById('frame');
    const btnUpload = document.getElementById('btnUpload');
    const btnMask = document.getElementById('btnMask');
    const btnDownload = document.getElementById('btnDownload');
    const btnReset = document.getElementById('btnReset');
    const rightPanel = document.getElementById('right-panel');
    const closePanel = document.getElementById('close-panel');
    const maskList = document.getElementById('mask-list');
    const panelReset = document.getElementById('panel-reset');

    btnUpload.addEventListener('click',()=>fileInput.click());
    fileInput.addEventListener('change', e=>{if(e.target.files[0]) loadImage(e.target.files[0]);});
    frame.addEventListener('dragover', e=>{e.preventDefault(); frame.classList.add('dragover');});
    frame.addEventListener('dragleave', ()=>frame.classList.remove('dragover'));
    frame.addEventListener('drop', e=>{
      e.preventDefault();
      frame.classList.remove('dragover');
      if(e.dataTransfer.files.length){
        const file = e.dataTransfer.files[0];
        if(file.type.startsWith('image/')) loadImage(file);
      }
    });

    function loadImage(file){
      const url = URL.createObjectURL(file);
      preview.src = url;
      preview.style.display='block';
      placeholder.style.display='none';
      const img = new Image();
      img.src=url;
      img.onload = ()=>{
        const aspectRatio = img.width/img.height;
        const maxWidth = Math.min(460, window.innerWidth*0.92);
        frame.style.width=maxWidth+'px';
        frame.style.height=maxWidth/aspectRatio+'px';
      }
    }

    btnMask.addEventListener('click',()=>{rightPanel.style.display='flex';});
    closePanel.addEventListener('click',()=>{rightPanel.style.display='none';});

    btnDownload.addEventListener('click', ()=>{
      const canvas=document.createElement('canvas');
      canvas.width=frame.clientWidth;
      canvas.height=frame.clientHeight;
      const ctx=canvas.getContext('2d');

      if(preview.src){
        const img = new Image();
        img.src=preview.src;
        img.onload=()=>{
          ctx.drawImage(img,0,0,canvas.width,canvas.height);
          document.querySelectorAll('.mask-container img').forEach(m=>{
            const cont=m.parentElement;
            const rect=cont.getBoundingClientRect();
            const frameRect=frame.getBoundingClientRect();
            const cx=(rect.left-frameRect.left);
            const cy=(rect.top-frameRect.top);
            ctx.save();
            ctx.translate(cx+cont.offsetWidth/2,cy+cont.offsetHeight/2);
            const style=window.getComputedStyle(cont);
            const transform=style.transform;
            let angle=0;
            if(transform && transform!=='none'){
              const values=transform.split('(')[1].split(')')[0].split(',');
              angle=Math.atan2(parseFloat(values[1]),parseFloat(values[0]));
            }
            ctx.rotate(angle);
            ctx.drawImage(m,-cont.offsetWidth/2,-cont.offsetHeight/2,cont.offsetWidth,cont.offsetHeight);
            ctx.restore();
          });
          const link=document.createElement('a');
          link.href=canvas.toDataURL('image/png');
          link.download='supermask.png';
          link.click();
        }
      }
    });

    btnReset.addEventListener('click',()=>{
      preview.removeAttribute('src'); preview.style.display='none'; placeholder.style.display='block';
      fileInput.value=''; frame.style.width='min(460px,92vw)'; frame.style.height='auto';
      document.querySelectorAll('.mask-container').forEach(m=>m.remove());
    });

    const masks=[];
    for(let i=1;i<=36;i++) masks.push(`masks/mask${i}.png`);
    masks.forEach(src=>{
      const img=document.createElement('img');
      img.src=src;
      img.addEventListener('click',()=>addMask(src));
      maskList.appendChild(img);
    });

    function addMask(src){
      const container=document.createElement('div');
      container.classList.add('mask-container');
      container.style.left='50%';
      container.style.top='50%';
      container.dataset.x=0; container.dataset.y=0; container.dataset.angle=0;
      container.dataset.w=100; container.dataset.h=100;

      const img=document.createElement('img');
      img.src=src; img.style.width='100px'; img.style.height='auto';
      container.appendChild(img);

      const handleBR=document.createElement('div');
      handleBR.classList.add('handle','br');
      container.appendChild(handleBR);

      const handleROT=document.createElement('div');
      handleROT.classList.add('handle','tr');
      container.appendChild(handleROT);

      frame.appendChild(container);

      // Drag to move
      let isDragging=false, startX, startY;
      container.addEventListener('mousedown',e=>{
        if(e.target!==container) return;
        isDragging=true; startX=e.clientX; startY=e.clientY;
        container.style.cursor='grabbing';
      });
      window.addEventListener('mousemove', e=>{
        if(!isDragging) return;
        const dx=e.clientX-startX, dy=e.clientY-startY;
        const x=parseFloat(container.dataset.x)+dx;
        const y=parseFloat(container.dataset.y)+dy;
        container.dataset.x=x; container.dataset.y=y;
        startX=e.clientX; startY=e.clientY;
        updateTransform(container);
      });
      window.addEventListener('mouseup', ()=>{ isDragging=false; container.style.cursor='grab'; });

      // Resize bottom-right
      let isResizing=false, resStartX, resStartY;
      handleBR.addEventListener('mousedown', e=>{
        e.stopPropagation(); isResizing=true; resStartX=e.clientX; resStartY=e.clientY;
      });
      window.addEventListener('mousemove', e=>{
        if(!isResizing) return;
        const dx=e.clientX-resStartX;
        const dy=e.clientY-resStartY;
        let w=parseFloat(container.dataset.w)+dx;
        let h=parseFloat(container.dataset.h)+dy;
        if(h<20) h=20; if(w<20) w=20;
        container.dataset.w=w; container.dataset.h=h;
        img.style.width=w+'px'; img.style.height=h+'px';
        resStartX=e.clientX; resStartY=e.clientY;
      });
      window.addEventListener('mouseup', ()=>{ isResizing=false; });

      // Rotate
      let isRotating=false, rotStartAngle=0;
      handleROT.addEventListener('mousedown', e=>{
        e.stopPropagation(); isRotating=true;
        const rect=container.getBoundingClientRect();
        const cx=rect.left+rect.width/2;
        const cy=rect.top+rect.height/2;
        rotStartAngle=Math.atan2(e.clientY-cy, e.clientX-cx)*180/Math.PI - parseFloat(container.dataset.angle);
      });
      window.addEventListener('mousemove', e=>{
        if(!isRotating) return;
        const rect=container.getBoundingClientRect();
        const cx=rect.left+rect.width/2;
        const cy=rect.top+rect.height/2;
        const angle=Math.atan2(e.clientY-cy, e.clientX-cx)*180/Math.PI - rotStartAngle;
        container.dataset.angle=angle;
        updateTransform(container);
      });
      window.addEventListener('mouseup', ()=>{ isRotating=false; });

      updateTransform(container);
    }

    function updateTransform(container){
      const x=parseFloat(container.dataset.x);
      const y=parseFloat(container.dataset.y);
      const angle=parseFloat(container.dataset.angle);
      container.style.transform=`translate(-50%,-50%) translate(${x}px,${y}px) rotate(${angle}deg)`;
      const img=container.querySelector('img');
      img.style.width=container.dataset.w+'px';
      img.style.height=container.dataset.h+'px';
    }

    panelReset.addEventListener('click',()=>{ document.querySelectorAll('.mask-container').forEach(m=>m.remove()); });

  </script>
</body>
</html>
